Module("stratego/asfix/anno",[Imports([Import("libstratego-lib")]),Signature([Constructors([OpDecl("Location",FunType([ConstType(SortNoArgs("FirstLine")),ConstType(SortNoArgs("FirstColumn")),ConstType(SortNoArgs("LastLine")),ConstType(SortNoArgs("LastColumn"))],ConstType(SortNoArgs("Location"))))])]),Strategies([SDefT("asfix-anno-position-info",[],[DefaultVarDec("path")],Seq(Match(Var("pt")),Prim("\"STRSGLR_anno_position_info\"",[Var("pt"),Var("path")]))),SDefNoArgs("asfix-anno-location",Seq(Match(Var("pt")),Prim("\"STRSGLR_anno_location\"",[Var("pt")])))]),Strategies([SDefNoArgs("asfix-anno-comments",CallT(SVar("asfix-anno-comments"),[],[NoAnnoList(List([NoAnnoList(Str("\"Comment\""))]))])),SDefT("asfix-anno-comments",[],[DefaultVarDec("s")],DynRuleScope([DynRuleScopeId("get-comment-sorts")],Seq(GenDynRules([SetDynRule(DynRuleId(RDecNoArgs("get-comment-sorts")),RuleNoCond(Wld,Var("s")))]),Call(SVar("asfix-anno-topdown-consnil"),[Call(SVar("try"),[CallNoArgs(SVar("AnnoComment"))])])))),RDefNoArgs("AnnoComment",Rule(NoAnnoList(ListTail([As(Var("a1"),NoAnnoList(Op("appl",[NoAnnoList(Op("prod",[NoAnnoList(List([NoAnnoList(Op("cf",[NoAnnoList(Op("layout",[]))]))])),NoAnnoList(Op("cf",[NoAnnoList(Op("opt",[NoAnnoList(Op("layout",[]))]))])),Wld])),Var("args")]))),Var("a2")],Var("as"))),NoAnnoList(ListTail([Var("a1"),Var("a2'")],Var("as"))),Seq(AM(BA(CallNoArgs(SVar("fetch-comment")),Var("args")),NoAnnoList(Tuple([Var("comment"),Var("sort")]))),AM(BA(Call(SVar("try"),[Call(SVar("oncetd"),[Scope(["p"],Seq(CallNoArgs(SVar("has-cons")),Seq(Match(AnnoList(Var("p"),[Var(ListVar("a*"))])),Build(AnnoList(Var("p"),[NoAnnoList(Tuple([NoAnnoList(Op("Comment",[Var("sort")])),Var("comment")])),Var(ListVar("a*"))])))))])]),Var("a2")),Var("a2'"))))),SDefNoArgs("fetch-comment",Seq(Where(AM(CallNoArgs(SVar("get-comment-sorts")),Var("sortnames"))),Seq(Call(SVar("oncetd"),[Scope(["sortname"],Seq(Match(NoAnnoList(Op("appl",[NoAnnoList(Op("prod",[Wld,NoAnnoList(Op("lex",[NoAnnoList(Op("sort",[Var("sortname")]))])),Wld])),Wld]))),Seq(Where(AM(BA(Call(SVar("fetch"),[Match(Var("sortname"))]),Var("sortnames")),Var("sort"))),Seq(CallNoArgs(SVar("asfix-anno-yield")),AM(Build(NoAnnoList(Tuple([RootApp(Id),Var("sortname")]))),Var("s"))))))]),Build(Var("s"))))),SDefNoArgs("has-cons",Where(Seq(Match(NoAnnoList(Op("appl",[NoAnnoList(Op("prod",[Wld,Wld,RootApp(Id)])),Wld]))),Call(SVar("oncetd"),[Match(NoAnnoList(Op("cons",[Wld])))]))))]),Strategies([SDef("asfix-anno-topdown-consnil",[DefaultVarDec("s")],Rec("x",Seq(CallNoArgs(SVar("s")),Call(SVar("asfix-anno-all-consnil"),[CallNoArgs(SVar("x"))])))),SDef("asfix-anno-all-consnil",[DefaultVarDec("s")],CondChoice(CallNoArgs(SVar("is-list")),Choice(Seq(ListCong([CallNoArgs(SVar("s"))],Id),ListCong([Id],CallNoArgs(SVar("s")))),ListCongNoTail([])),All(CallNoArgs(SVar("s")))))]),Rules([RDefNoArgs("asfix-anno-Kids",RuleNoCond(NoAnnoList(Op("appl",[Var("p"),Var("ts")])),App(CallNoArgs(SVar("concat")),Var("ts")))),RDefNoArgs("asfix-anno-Kids'",RuleNoCond(Var("x"),NoAnnoList(List([Var("x")]))))]),Strategies([SDefNoArgs("asfix-anno-yield",Seq(Rec("x",LChoice(Seq(Call(SVar("appl"),[Id,Call(SVar("map"),[CallNoArgs(SVar("x"))])]),CallNoArgs(SVar("asfix-anno-Kids"))),CallNoArgs(SVar("asfix-anno-Kids'")))),CallNoArgs(SVar("implode-string"))))]),Signature([Constructors([OpDecl("Comment",FunType([ConstType(SortNoArgs("String"))],ConstType(SortNoArgs("AnnoKey"))))])])])
