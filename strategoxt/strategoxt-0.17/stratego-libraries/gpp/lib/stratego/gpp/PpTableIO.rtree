Module("stratego/gpp/PpTableIO",[Imports([Import("pp-table"),Import("libstratego-sglr")]),Strategies([SDefNoArgs("pptable-make-hashtable",Seq(Where(Assign(Var("tbl"),RootApp(CallNoArgs(SVar("new-hashtable"))))),Seq(Call(SVar("map"),[Seq(Match(NoAnnoList(Op("PP-Table",[RootApp(Id)]))),Seq(CallNoArgs(SVar("reverse")),Call(SVar("map"),[Seq(CallNoArgs(SVar("pptable-desugar-entry")),CallT(SVar("pptable-store-entry"),[],[Var("tbl")]))])))]),Build(Var("tbl"))))),SDefT("pptable-store-entry",[],[DefaultVarDec("tbl")],Seq(Match(As(Var("entry"),NoAnnoList(Op("PP-Entry",[Var("path"),Var("value")])))),BA(CallT(SVar("hashtable-put"),[],[App(CallNoArgs(SVar("pptable-make-key")),Var("entry")),NoAnnoList(Tuple([Var("path"),Var("value")]))]),Var("tbl"))))]),Strategies([SDefNoArgs("pptable-path-to-string",Match(NoAnnoList(Op("Path1",[RootApp(Id)])))),SDefNoArgs("pptable-path-to-string",Seq(Match(NoAnnoList(Op("Path",[Var("s1"),Var("s2")]))),Seq(AM(BA(Seq(Call(SVar("map"),[LRule(RuleNoCond(NoAnnoList(Op("selector",[Var("a"),Var("b")])),NoAnnoList(List([NoAnnoList(Str("\".\"")),App(CallNoArgs(SVar("int-to-string")),Var("a")),NoAnnoList(Str("\":\"")),Var("b")]))))]),CallNoArgs(SVar("concat"))),Var("s2")),Var("s3")),BA(CallNoArgs(SVar("concat-strings")),NoAnnoList(ListTail([Var("s1")],Var("s3")))))))]),Strategies([RDefNoArgs("pptable-make-key",Rule(NoAnnoList(Op("PP-Entry",[NoAnnoList(Op("Path1",[Var("s")])),Var("value")])),NoAnnoList(Tuple([Var("arity"),NoAnnoList(List([Var("s")]))])),AM(BA(CallNoArgs(SVar("pptable-arity-of-template")),Var("value")),Var("arity")))),RDefNoArgs("pptable-make-key",Rule(NoAnnoList(Op("PP-Entry",[NoAnnoList(Op("Path",[Var("s1"),Var("s2")])),Var("value")])),App(CallNoArgs(SVar("reverse")),NoAnnoList(ListTail([Var("s1")],Var("xs")))),AM(BA(Call(SVar("map"),[Match(NoAnnoList(Op("selector",[RootApp(Id),Wld])))]),Var("s2")),Var("xs")))),SDefNoArgs("pptable-arity-of-template",Seq(Call(SVar("collect"),[Call(SVar("Arg"),[Id])]),CallNoArgs(SVar("length"))))]),Strategies([SDefNoArgs("pptable-desugar-entry",Call(SVar("topdown"),[Call(SVar("try"),[Choice(Call(SVar("Arg"),[CallNoArgs(SVar("string-to-int"))]),Choice(Call(SVar("Arg2"),[CallNoArgs(SVar("string-to-int")),CallNoArgs(SVar("string-to-int"))]),Choice(Call(SVar("S"),[Seq(CallNoArgs(SVar("un-double-quote")),CallNoArgs(SVar("unescape")))]),Call(SVar("selector"),[CallNoArgs(SVar("string-to-int")),Id]))))])]))]),Strategies([SDefT("pptable-get-log",[],[DefaultVarDec("tbl")],Seq(Match(Var("key")),LChoice(BA(CallT(SVar("hashtable-get"),[],[Var("key")]),Var("tbl")),Seq(CallT(SVar("log"),[],[NoAnnoList(Op("Error",[])),App(CallNoArgs(SVar("concat-strings")),NoAnnoList(List([NoAnnoList(Str("\"No pp entry found for: \"")),App(CallNoArgs(SVar("write-to-string")),Var("key"))])))]),Fail))))])])
