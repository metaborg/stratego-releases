Module("stratego/gpp/AstToBox",[Imports([Import("stratego/gpp/PpTableIO"),Import("stratego/gpp/Instantiate"),Import("stratego/gpp/Util")]),Strategies([SDefT("ast2abox",[],[DefaultVarDec("pptables")],Seq(Where(Assign(Var("tbl"),App(CallNoArgs(SVar("pptable-make-hashtable")),Var("pptables")))),Seq(CallT(SVar("trm2abox"),[],[Var("tbl")]),IfThen(CallNoArgs(SVar("is-list")),Build(NoAnnoList(Op("HV",[NoAnnoList(List([])),RootApp(Id)])))))))]),Strategies([SDefT("trm2abox",[],[DefaultVarDec("tbl")],LChoice(CallT(SVar("trm2abox-string"),[],[Var("tbl")]),LChoice(CallT(SVar("trm2abox-int"),[],[Var("tbl")]),LChoice(CallT(SVar("trm2abox-real"),[],[Var("tbl")]),LChoice(CallT(SVar("trm2abox-list"),[],[Var("tbl")]),LChoice(CallT(SVar("trm2abox-appl"),[],[Var("tbl")]),Seq(CallT(SVar("log"),[],[NoAnnoList(Op("Error",[])),NoAnnoList(Str("\"Cannot rewrite to box: \"")),RootApp(Id)]),Fail))))))),SDefT("trm2abox-string",[],[DefaultVarDec("tbl")],Build(NoAnnoList(Op("S",[RootApp(CallNoArgs(SVar("is-string")))])))),SDefT("trm2abox-real",[],[DefaultVarDec("tbl")],Build(NoAnnoList(Op("S",[RootApp(Seq(CallNoArgs(SVar("is-real")),CallNoArgs(SVar("real-to-string"))))])))),SDefT("trm2abox-int",[],[DefaultVarDec("tbl")],Build(NoAnnoList(Op("S",[RootApp(Seq(CallNoArgs(SVar("is-int")),CallNoArgs(SVar("int-to-string"))))])))),SDefT("trm2abox-list",[],[DefaultVarDec("tbl")],Seq(CallNoArgs(SVar("is-list")),Call(SVar("map"),[CallT(SVar("trm2abox"),[],[Var("tbl")])]))),SDefT("trm2abox-appl",[],[DefaultVarDec("tbl")],Seq(Match(NoAnnoList(Explode(Var("f"),Var("args")))),Seq(Where(AM(BA(CallNoArgs(SVar("length")),Var("args")),Var("arity"))),Seq(AM(BA(CallT(SVar("pptable-get-log"),[],[Var("tbl")]),NoAnnoList(Tuple([Var("arity"),NoAnnoList(List([Var("f")]))]))),NoAnnoList(Tuple([Wld,Var("template")]))),Seq(AM(Build(NoAnnoList(List([Var("f")]))),Var("currentpath")),Seq(Let([SDefT("narg2abox",[],[DefaultVarDec("n")],CallT(SVar("arg2abox"),[],[Var("tbl"),Var("n"),Var("currentpath")]))],AM(BA(CallT(SVar("nmap"),[CallNoArgs(SVar("narg2abox"))],[NoAnnoList(Int("1"))]),Var("args")),Var("aboxes"))),BA(CallT(SVar("gpp-instantiate"),[],[Var("aboxes")]),Var("template"))))))))]),Strategies([SDefT("arg2abox",[],[DefaultVarDec("tbl"),DefaultVarDec("n"),DefaultVarDec("path")],Seq(Match(Var("arg")),Seq(AM(Build(NoAnnoList(ListTail([Var("n")],Var("path")))),Var("new_path")),LChoice(Seq(AM(BA(CallT(SVar("hashtable-get"),[],[Var("new_path")]),Var("tbl")),NoAnnoList(Tuple([Var("full_path"),Var("template")]))),BA(CallT(SVar("symbol2abox"),[],[Var("tbl"),App(CallNoArgs(SVar("pptable-path-get-symbol")),Var("full_path")),Var("new_path"),Var("template")]),Var("arg"))),BA(CallT(SVar("trm2abox"),[],[Var("tbl")]),Var("arg"))))))]),Strategies([SDefT("symbol2abox",[],[DefaultVarDec("tbl"),DefaultVarDec("symbol"),DefaultVarDec("path"),DefaultVarDec("template")],LChoice(Seq(Match(NoAnnoList(Op("alt",[Wld,Wld]))),CallT(SVar("symbol2abox-alt"),[],[Var("tbl"),Var("path"),Var("template")])),LChoice(Seq(Choice(Match(NoAnnoList(Op("Some",[Wld]))),Call(SVar("None"),[])),CallT(SVar("symbol2abox-opt"),[],[Var("tbl"),Var("path"),Var("template")])),LChoice(Seq(Where(Seq(Build(Var("symbol")),Choice(Match(NoAnnoList(Str("\"iter\""))),Match(NoAnnoList(Str("\"iter-star\"")))))),CallT(SVar("symbol2abox-iter"),[],[Var("tbl"),Var("path"),Var("template")])),LChoice(Seq(Where(Seq(Build(Var("symbol")),Choice(Match(NoAnnoList(Str("\"iter-sep\""))),Match(NoAnnoList(Str("\"iter-star-sep\"")))))),CallT(SVar("symbol2abox-iter-sep"),[],[Var("tbl"),Var("path"),Var("template")])),Seq(Where(AM(Build(Var("symbol")),NoAnnoList(Str("\"seq\"")))),CallT(SVar("symbol2abox-seq"),[],[Var("tbl"),Var("path"),Var("template")]))))))),SDefT("symbol2abox-alt",[],[DefaultVarDec("tbl"),DefaultVarDec("path"),DefaultVarDec("template")],Seq(Match(NoAnnoList(Op("alt",[Var("n"),NoAnnoList(List([]))]))),BA(CallT(SVar("gpp-instantiate"),[],[NoAnnoList(List([]))]),NoAnnoList(List([App(CallT(SVar("index"),[],[Var("n")]),Var("template"))]))))),SDefT("symbol2abox-alt",[],[DefaultVarDec("tbl"),DefaultVarDec("path"),DefaultVarDec("template")],Seq(Match(NoAnnoList(Op("alt",[Var("n"),NoAnnoList(List([Var("arg")]))]))),Seq(AM(BA(CallT(SVar("arg2abox"),[],[Var("tbl"),Var("n"),Var("path")]),Var("arg")),Var("abox")),BA(CallT(SVar("gpp-instantiate"),[],[NoAnnoList(List([Var("abox")]))]),NoAnnoList(List([App(CallT(SVar("index"),[],[Var("n")]),Var("template"))])))))),SDefT("symbol2abox-opt",[],[DefaultVarDec("tbl"),DefaultVarDec("path"),DefaultVarDec("template")],Seq(Match(NoAnnoList(Op("Some",[RootApp(Id)]))),Seq(AM(CallT(SVar("arg2abox"),[],[Var("tbl"),NoAnnoList(Int("1")),Var("path")]),Var("abox")),BA(CallT(SVar("gpp-instantiate"),[],[NoAnnoList(List([Var("abox")]))]),Var("template"))))),SDefT("symbol2abox-opt",[],[DefaultVarDec("tbl"),DefaultVarDec("path"),DefaultVarDec("template")],Seq(Match(NoAnnoList(Op("None",[]))),Build(NoAnnoList(List([]))))),SDefT("symbol2abox-iter",[],[DefaultVarDec("tbl"),DefaultVarDec("path"),DefaultVarDec("template")],Seq(AM(Call(SVar("map"),[CallT(SVar("arg2abox"),[],[Var("tbl"),NoAnnoList(Int("1")),Var("path")])]),Var("abox")),BA(CallT(SVar("gpp-instantiate"),[],[NoAnnoList(List([Var("abox")]))]),Var("template")))),SDefT("symbol2abox-iter-sep",[],[DefaultVarDec("tbl"),DefaultVarDec("path"),DefaultVarDec("template")],Seq(Call(SVar("map"),[CallT(SVar("arg2abox"),[],[Var("tbl"),NoAnnoList(Int("1")),Var("path")])]),Seq(IfThen(AM(BA(Call(SVar("collect-om"),[Match(NoAnnoList(Op("S",[Wld]))),CallNoArgs(SVar("conc"))]),Var("template")),NoAnnoList(List([Wld]))),Rec("x",LChoice(LRule(RuleNoCond(NoAnnoList(List([])),NoAnnoList(List([])))),LChoice(LRule(RuleNoCond(NoAnnoList(List([Var("e")])),NoAnnoList(List([Var("e")])))),LRule(RuleNoCond(NoAnnoList(ListTail([Var("e")],Var("xs"))),NoAnnoList(ListTail([Var("e"),Var("e")],App(CallNoArgs(SVar("x")),Var("xs")))))))))),CallT(SVar("gpp-instantiate-sep-list"),[],[Var("template")])))),SDefT("symbol2abox-seq",[],[DefaultVarDec("tbl"),DefaultVarDec("path"),DefaultVarDec("template")],Seq(CallNoArgs(SVar("TupleToList")),Seq(AM(Call(SVar("nzip"),[LRule(RuleNoCond(NoAnnoList(Tuple([Var("n"),Var("t")])),App(CallT(SVar("arg2abox"),[],[Var("tbl"),Var("n"),Var("path")]),Var("t"))))]),Var("abox")),BA(CallT(SVar("gpp-instantiate"),[],[Var("abox")]),Var("template")))))]),Rules([RDefNoArgs("pptable-path-get-symbol",Rule(NoAnnoList(Op("Path",[Var("cons-name"),Var("selectors")])),Var("symbol"),BA(Call(SVar("at-last"),[Match(NoAnnoList(List([NoAnnoList(Op("selector",[Wld,Var("symbol")]))])))]),Var("selectors"))))])])
