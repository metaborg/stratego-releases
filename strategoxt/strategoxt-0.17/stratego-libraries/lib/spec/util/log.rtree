Module("util/log",[Imports([Import("collection/tuple/cons"),Import("collection/tuple/common"),Import("collection/list/common")]),Signature([Constructors([OpDecl("Emergency",ConstType(SortNoArgs("Severity"))),OpDecl("Alert",ConstType(SortNoArgs("Severity"))),OpDecl("Critical",ConstType(SortNoArgs("Severity"))),OpDecl("Error",ConstType(SortNoArgs("Severity"))),OpDecl("Warning",ConstType(SortNoArgs("Severity"))),OpDecl("Notice",ConstType(SortNoArgs("Severity"))),OpDecl("Info",ConstType(SortNoArgs("Severity"))),OpDecl("Debug",ConstType(SortNoArgs("Severity"))),OpDecl("Vomit",ConstType(SortNoArgs("Severity")))])]),Strategies([SDefT("debug-area",[DefaultVarDec("s")],[DefaultVarDec("msg")],Seq(CallT(SVar("log"),[],[NoAnnoList(Op("Debug",[])),App(CallNoArgs(SVar("conc-strings")),NoAnnoList(Tuple([NoAnnoList(Str("\"entering area \"")),Var("msg")])))]),Seq(CallNoArgs(SVar("s")),CallT(SVar("log"),[],[NoAnnoList(Op("Debug",[])),App(CallNoArgs(SVar("conc-strings")),NoAnnoList(Tuple([NoAnnoList(Str("\"leaving area \"")),Var("msg")])))])))),SDefT("risky",[DefaultVarDec("s")],[DefaultVarDec("msg")],CallT(SVar("risky"),[CallNoArgs(SVar("s"))],[NoAnnoList(Op("Error",[])),Var("msg")])),SDefT("risky",[DefaultVarDec("s")],[DefaultVarDec("severity"),DefaultVarDec("msg")],Call(SVar("restore"),[CallNoArgs(SVar("s")),CallT(SVar("log"),[],[Var("severity"),Var("msg"),RootApp(Id)])]))]),Strategies([SDefT("log",[],[VarDec("severity",ConstType(SortNoArgs("Severity"))),DefaultVarDec("msg"),DefaultVarDec("term")],CallT(SVar("if-log-severity"),[Seq(CallT(SVar("log"),[],[Var("severity"),Var("msg")]),Where(Seq(BA(Seq(CallNoArgs(SVar("copy-char")),CallNoArgs(SVar("log-puts"))),NoAnnoList(Tuple([App(CallNoArgs(SVar("add")),NoAnnoList(Tuple([App(Seq(CallNoArgs(SVar("severity-string")),CallNoArgs(SVar("string-length"))),Var("severity")),NoAnnoList(Int("3"))]))),NoAnnoList(Char("' '"))]))),Seq(BA(CallNoArgs(SVar("write-in-text-to-stream")),NoAnnoList(Tuple([RootApp(CallNoArgs(SVar("log-stream"))),Var("term")]))),BA(CallNoArgs(SVar("log-puts")),NoAnnoList(Str("\"\\n\"")))))))],[Var("severity")])),SDefT("log",[],[VarDec("severity",ConstType(SortNoArgs("Severity"))),DefaultVarDec("msg")],CallT(SVar("if-log-severity"),[Where(Seq(BA(Call(SVar("try"),[Seq(Not(CallNoArgs(SVar("is-list"))),Build(NoAnnoList(List([RootApp(Id)]))))]),Var("msg")),Seq(Call(SVar("map"),[LChoice(CallNoArgs(SVar("is-string")),CallNoArgs(SVar("write-to-string")))]),Seq(BA(Seq(CallNoArgs(SVar("concat-strings")),CallNoArgs(SVar("log-puts"))),NoAnnoList(ListTail([NoAnnoList(Str("\"[ \"")),RootApp(CallNoArgs(SVar("log-src"))),NoAnnoList(Str("\" | \"")),App(CallNoArgs(SVar("severity-string")),Var("severity")),NoAnnoList(Str("\" ] \""))],RootApp(Id)))),BA(CallNoArgs(SVar("log-puts")),NoAnnoList(Str("\"\\n\"")))))))],[Var("severity")])),SDefT("if-log-severity",[DefaultVarDec("s")],[DefaultVarDec("severity")],CallT(SVar("if-verbose"),[CallNoArgs(SVar("s"))],[App(CallNoArgs(SVar("verbose-level")),Var("severity"))]))]),Strategies([SDefNoArgs("log-stream",LChoice(BA(CallNoArgs(SVar("get-config")),NoAnnoList(Str("\"log-stream\""))),LChoice(Seq(BA(CallNoArgs(SVar("getenv")),NoAnnoList(Str("\"STRATEGO_LOG\""))),BA(CallNoArgs(SVar("fopen")),NoAnnoList(Tuple([RootApp(Id),NoAnnoList(Str("\"a\""))])))),BA(CallNoArgs(SVar("stderr-stream")),NoAnnoList(Tuple([])))))),SDefNoArgs("set-log-stream",BA(CallNoArgs(SVar("set-config")),NoAnnoList(Tuple([NoAnnoList(Str("\"log-stream\"")),RootApp(Id)])))),SDefNoArgs("log-puts",BA(CallNoArgs(SVar("fputs")),NoAnnoList(Tuple([RootApp(Id),App(CallNoArgs(SVar("log-stream")),NoAnnoList(Tuple([])))])))),SDefNoArgs("log-src",LChoice(Seq(CallNoArgs(SVar("whoami")),CallNoArgs(SVar("base-filename"))),Build(NoAnnoList(Str("\"identity crisis\"")))))]),Rules([RDefNoArgs("verbose-level",RuleNoCond(NoAnnoList(Op("Emergency",[])),NoAnnoList(Int("-10")))),RDefNoArgs("verbose-level",RuleNoCond(NoAnnoList(Op("Alert",[])),NoAnnoList(Int("-5")))),RDefNoArgs("verbose-level",RuleNoCond(NoAnnoList(Op("Critical",[])),NoAnnoList(Int("-2")))),RDefNoArgs("verbose-level",RuleNoCond(NoAnnoList(Op("Error",[])),NoAnnoList(Int("0")))),RDefNoArgs("verbose-level",RuleNoCond(NoAnnoList(Op("Warning",[])),NoAnnoList(Int("1")))),RDefNoArgs("verbose-level",RuleNoCond(NoAnnoList(Op("Info",[])),NoAnnoList(Int("1")))),RDefNoArgs("verbose-level",RuleNoCond(NoAnnoList(Op("Notice",[])),NoAnnoList(Int("2")))),RDefNoArgs("verbose-level",RuleNoCond(NoAnnoList(Op("Debug",[])),NoAnnoList(Int("4")))),RDefNoArgs("verbose-level",RuleNoCond(NoAnnoList(Op("Vomit",[])),NoAnnoList(Int("10")))),RDefNoArgs("severity-string",RuleNoCond(NoAnnoList(Op("Emergency",[])),NoAnnoList(Str("\"emergency\"")))),RDefNoArgs("severity-string",RuleNoCond(NoAnnoList(Op("Alert",[])),NoAnnoList(Str("\"alert\"")))),RDefNoArgs("severity-string",RuleNoCond(NoAnnoList(Op("Critical",[])),NoAnnoList(Str("\"critical\"")))),RDefNoArgs("severity-string",RuleNoCond(NoAnnoList(Op("Error",[])),NoAnnoList(Str("\"error\"")))),RDefNoArgs("severity-string",RuleNoCond(NoAnnoList(Op("Info",[])),NoAnnoList(Str("\"info\"")))),RDefNoArgs("severity-string",RuleNoCond(NoAnnoList(Op("Warning",[])),NoAnnoList(Str("\"warning\"")))),RDefNoArgs("severity-string",RuleNoCond(NoAnnoList(Op("Notice",[])),NoAnnoList(Str("\"notice\"")))),RDefNoArgs("severity-string",RuleNoCond(NoAnnoList(Op("Debug",[])),NoAnnoList(Str("\"debug\"")))),RDefNoArgs("severity-string",RuleNoCond(NoAnnoList(Op("Vomit",[])),NoAnnoList(Str("\"vomit\"")))),RDefNoArgs("string-to-level",Rule(NoAnnoList(Str("\"emergency\"")),Var("level"),AM(BA(CallNoArgs(SVar("verbose-level")),NoAnnoList(Op("Emergency",[]))),Var("level")))),RDefNoArgs("string-to-level",Rule(NoAnnoList(Str("\"alert\"")),Var("level"),AM(BA(CallNoArgs(SVar("verbose-level")),NoAnnoList(Op("Alert",[]))),Var("level")))),RDefNoArgs("string-to-level",Rule(NoAnnoList(Str("\"critical\"")),Var("level"),AM(BA(CallNoArgs(SVar("verbose-level")),NoAnnoList(Op("Critical",[]))),Var("level")))),RDefNoArgs("string-to-level",Rule(NoAnnoList(Str("\"error\"")),Var("level"),AM(BA(CallNoArgs(SVar("verbose-level")),NoAnnoList(Op("Error",[]))),Var("level")))),RDefNoArgs("string-to-level",Rule(NoAnnoList(Str("\"warning\"")),Var("level"),AM(BA(CallNoArgs(SVar("verbose-level")),NoAnnoList(Op("Warning",[]))),Var("level")))),RDefNoArgs("string-to-level",Rule(NoAnnoList(Str("\"notice\"")),Var("level"),AM(BA(CallNoArgs(SVar("verbose-level")),NoAnnoList(Op("Notice",[]))),Var("level")))),RDefNoArgs("string-to-level",Rule(NoAnnoList(Str("\"info\"")),Var("level"),AM(BA(CallNoArgs(SVar("verbose-level")),NoAnnoList(Op("Info",[]))),Var("level")))),RDefNoArgs("string-to-level",Rule(NoAnnoList(Str("\"debug\"")),Var("level"),AM(BA(CallNoArgs(SVar("verbose-level")),NoAnnoList(Op("Debug",[]))),Var("level")))),RDefNoArgs("string-to-level",Rule(NoAnnoList(Str("\"vomit\"")),Var("level"),AM(BA(CallNoArgs(SVar("verbose-level")),NoAnnoList(Op("Vomit",[]))),Var("level"))))]),Strategies([SDefT("fatal-err",[],[VarDec("msg",ConstType(SortNoArgs("String")))],Seq(CallT(SVar("log"),[],[NoAnnoList(Op("Critical",[])),Var("msg"),RootApp(Id)]),BA(CallNoArgs(SVar("exit")),NoAnnoList(Int("1"))))),SDefT("err",[],[VarDec("msg",ConstType(SortNoArgs("String")))],CallT(SVar("log"),[],[NoAnnoList(Op("Error",[])),Var("msg"),RootApp(Id)])),SDefT("warn",[],[VarDec("msg",ConstType(SortNoArgs("String")))],CallT(SVar("log"),[],[NoAnnoList(Op("Warning",[])),Var("msg"),RootApp(Id)])),SDefT("notice",[],[VarDec("msg",ConstType(SortNoArgs("String")))],CallT(SVar("log"),[],[NoAnnoList(Op("Notice",[])),Var("msg"),RootApp(Id)])),SDefT("dbg",[],[VarDec("msg",ConstType(SortNoArgs("String")))],CallT(SVar("log"),[],[NoAnnoList(Op("Debug",[])),Var("msg"),RootApp(Id)]))]),Strategies([SDefT("fatal-err-msg",[],[VarDec("msg",ConstType(SortNoArgs("String")))],Seq(CallT(SVar("log"),[],[NoAnnoList(Op("Critical",[])),Var("msg")]),BA(CallNoArgs(SVar("exit")),NoAnnoList(Int("1"))))),SDefT("err-msg",[],[VarDec("msg",ConstType(SortNoArgs("String")))],CallT(SVar("log"),[],[NoAnnoList(Op("Error",[])),Var("msg")])),SDefT("warn-msg",[],[VarDec("msg",ConstType(SortNoArgs("String")))],CallT(SVar("log"),[],[NoAnnoList(Op("Warning",[])),Var("msg")])),SDefT("notice-msg",[],[VarDec("msg",ConstType(SortNoArgs("String")))],CallT(SVar("log"),[],[NoAnnoList(Op("Notice",[])),Var("msg")]))])])
