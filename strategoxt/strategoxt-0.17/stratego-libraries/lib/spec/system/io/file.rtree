Module("system/io/file",[Imports([ImportWildcard("system/io"),ImportWildcard("collection/list"),Import("term/string")]),Signature([Constructors([OpDecl("Stream",FunType([ConstType(SortNoArgs("ImplDep"))],ConstType(SortNoArgs("Stream")))),OpDecl("Path",FunType([ConstType(SortNoArgs("String"))],ConstType(SortNoArgs("FileLoc")))),OpDecl("stdin",ConstType(SortNoArgs("FileLoc"))),OpDecl("stdout",ConstType(SortNoArgs("FileLoc"))),OpDecl("stderr",ConstType(SortNoArgs("FileLoc")))])]),Strategies([SDefNoArgs("open-stream",Seq(Match(NoAnnoList(Tuple([Wld,Wld]))),LChoice(Seq(CallNoArgs(SVar("Fst")),CallNoArgs(SVar("stdio-stream"))),LChoice(Seq(TupleCong(Match(NoAnnoList(Op("Path",[RootApp(Id)]))),[Id]),CallNoArgs(SVar("fopen"))),Seq(TupleCong(CallNoArgs(SVar("is-string")),[Id]),CallNoArgs(SVar("fopen"))))))),SDefNoArgs("stdio-stream",Seq(Match(NoAnnoList(Op("stdin",[]))),CallNoArgs(SVar("stdin-stream")))),SDefNoArgs("stdio-stream",Seq(Match(NoAnnoList(Op("stdout",[]))),CallNoArgs(SVar("stdout-stream")))),SDefNoArgs("stdio-stream",Seq(Match(NoAnnoList(Op("stderr",[]))),CallNoArgs(SVar("stderr-stream")))),SDefNoArgs("stdin-stream",Seq(PrimNoArgs("\"SSL_stdin_stream\""),Build(NoAnnoList(Op("Stream",[RootApp(Id)]))))),SDefNoArgs("stdout-stream",Seq(PrimNoArgs("\"SSL_stdout_stream\""),Build(NoAnnoList(Op("Stream",[RootApp(Id)]))))),SDefNoArgs("stderr-stream",Seq(PrimNoArgs("\"SSL_stderr_stream\""),Build(NoAnnoList(Op("Stream",[RootApp(Id)])))))]),Strategies([SDefNoArgs("fopen",Seq(Match(NoAnnoList(Tuple([Var("pathname"),Var("mode")]))),Seq(Prim("\"SSL_fopen\"",[Var("pathname"),Var("mode")]),Build(NoAnnoList(Op("Stream",[RootApp(Id)])))))),SDefNoArgs("fclose",LChoice(Seq(Match(NoAnnoList(Op("Stream",[Var("stream")]))),Prim("\"SSL_fclose\"",[Var("stream")])),Seq(Match(Var("stream-old")),Prim("\"SSL_fclose\"",[Var("stream-old")])))),SDefNoArgs("fflush",LChoice(Seq(Match(NoAnnoList(Op("Stream",[Var("stream")]))),Seq(Prim("\"SSL_fflush\"",[Var("stream")]),Build(NoAnnoList(Op("Stream",[RootApp(Id)]))))),Seq(Match(Var("stream-old")),Seq(Prim("\"SSL_fflush\"",[Var("stream-old")]),Build(NoAnnoList(Op("Stream",[RootApp(Id)])))))))]),Strategies([SDefNoArgs("fputs",Seq(Match(NoAnnoList(Tuple([Var("str"),NoAnnoList(Op("Stream",[Var("stream")]))]))),Seq(Prim("\"SSL_fputs\"",[Var("str"),Var("stream")]),Build(NoAnnoList(Op("Stream",[RootApp(Id)])))))),SDefNoArgs("puts",Seq(Match(Var("str")),Seq(Prim("\"SSL_puts\"",[Var("str")]),Build(NoAnnoList(Op("Stream",[RootApp(Id)])))))),SDefNoArgs("fputc",Seq(Match(NoAnnoList(Tuple([Var("c"),NoAnnoList(Op("Stream",[Var("stream")]))]))),Seq(Prim("\"SSL_fputc\"",[Var("c"),Var("stream")]),Build(NoAnnoList(Op("Stream",[RootApp(Id)]))))))]),Strategies([SDefNoArgs("fgetc",Seq(Match(NoAnnoList(Op("Stream",[Var("stream")]))),Prim("\"SSL_fgetc\"",[Var("stream")])))]),Strategies([SDefNoArgs("tmpnam",PrimNoArgs("\"SSL_tmpnam\""))]),Strategies([SDefNoArgs("dirname",Call(SVar("string-as-chars"),[Seq(Call(SVar("try"),[Seq(CallNoArgs(SVar("split-init-last")),Match(NoAnnoList(Tuple([RootApp(Id),NoAnnoList(Char("'/'"))]))))]),GuardedLChoice(Match(NoAnnoList(List([]))),Build(NoAnnoList(List([NoAnnoList(Char("'/'"))]))),Seq(CallNoArgs(SVar("init")),Seq(Call(SVar("repeat"),[Seq(CallNoArgs(SVar("split-init-last")),Seq(TupleCong(Id,[Not(Match(NoAnnoList(Char("'/'"))))]),CallNoArgs(SVar("Fst"))))]),GuardedLChoice(Match(NoAnnoList(List([]))),Build(NoAnnoList(List([NoAnnoList(Char("'.'"))]))),Seq(Call(SVar("repeat"),[Seq(CallNoArgs(SVar("split-init-last")),Match(NoAnnoList(Tuple([RootApp(Id),NoAnnoList(Char("'/'"))]))))]),GuardedLChoice(Match(NoAnnoList(List([]))),Build(NoAnnoList(List([NoAnnoList(Char("'/'"))]))),Id)))))))])),SDefNoArgs("is-abspath",Where(Seq(CallNoArgs(SVar("explode-string")),Match(NoAnnoList(ListTail([NoAnnoList(Char("'/'"))],Wld)))))),SDefNoArgs("is-relpath",Not(CallNoArgs(SVar("is-abspath")))),SDefNoArgs("base-filename",Seq(BA(CallNoArgs(SVar("string-tokenize")),NoAnnoList(Tuple([NoAnnoList(List([NoAnnoList(Char("'/'"))])),RootApp(Id)]))),CallNoArgs(SVar("last"))))]),Strategies([SDefT("guarantee-extension",[],[DefaultVarDec("ext")],Seq(CallNoArgs(SVar("remove-extension")),BA(CallNoArgs(SVar("add-extension")),NoAnnoList(Tuple([RootApp(Id),Var("ext")]))))),SDefT("has-extension",[],[DefaultVarDec("ext")],Call(SVar("test-extension"),[Match(Var("ext"))])),SDef("test-extension",[DefaultVarDec("ext")],Where(Seq(CallNoArgs(SVar("get-extension")),CallNoArgs(SVar("ext"))))),RDefNoArgs("add-extension",RuleNoCond(NoAnnoList(Tuple([Var("name"),Var("ext")])),App(CallNoArgs(SVar("concat-strings")),NoAnnoList(List([Var("name"),NoAnnoList(Str("\".\"")),Var("ext")]))))),SDefNoArgs("remove-extension",IfThen(Seq(CallNoArgs(SVar("get-extension")),Seq(CallNoArgs(SVar("explode-string")),AM(Build(NoAnnoList(ListTail([NoAnnoList(Char("'.'"))],RootApp(Id)))),Var("ext")))),Seq(CallNoArgs(SVar("explode-string")),Seq(Call(SVar("at-suffix"),[Seq(Match(Var("ext")),Build(NoAnnoList(List([]))))]),CallNoArgs(SVar("implode-string")))))),SDefNoArgs("get-extension",Seq(CallNoArgs(SVar("explode-string")),Seq(CallT(SVar("list-tokenize"),[],[NoAnnoList(List([NoAnnoList(Char("'.'"))]))]),Seq(Match(NoAnnoList(ListTail([Wld,Wld],Wld))),Seq(Call(SVar("at-suffix"),[Seq(Match(NoAnnoList(List([Wld,Wld]))),Match(Var("lastwo")))]),Seq(AM(Build(Var("lastwo")),NoAnnoList(List([Var("base"),Var("ext")]))),Seq(Where(Seq(BA(Not(Call(SVar("fetch"),[Choice(Match(NoAnnoList(Char("'/'"))),Match(NoAnnoList(Char("'\\'"))))])),Var("ext")),BA(Seq(CallNoArgs(SVar("last")),Not(Choice(Match(NoAnnoList(Char("'/'"))),CharCong("'\\'")))),Var("base")))),BA(CallNoArgs(SVar("implode-string")),Var("ext")))))))))])])
