Module("lang/scoped-finite-map",[Imports([Import("collection/hash-table/common"),ImportWildcard("collection/list"),Import("strategy/conditional")]),Signature([Constructors([OpDecl("Scopes",ConstType(SortNoArgs("Key")))])]),Strategies([SDef("init-name-space",[DefaultVarDec("ns")],Where(Seq(CallNoArgs(SVar("ns")),CallNoArgs(SVar("table-create"))))),SDef("exit-name-space",[DefaultVarDec("ns")],Where(Seq(CallNoArgs(SVar("ns")),CallNoArgs(SVar("table-destroy"))))),SDef("begin-scope",[DefaultVarDec("ns")],Where(Seq(AM(CallNoArgs(SVar("ns")),Var("ns")),BA(CallNoArgs(SVar("table-put")),NoAnnoList(Tuple([Var("ns"),NoAnnoList(Op("Scopes",[])),NoAnnoList(ListTail([NoAnnoList(List([]))],App(LChoice(CallNoArgs(SVar("table-get")),Build(NoAnnoList(List([])))),NoAnnoList(Tuple([Var("ns"),NoAnnoList(Op("Scopes",[]))])))))])))))),SDef("end-scope",[DefaultVarDec("ns")],Where(Seq(AM(CallNoArgs(SVar("ns")),Var("ns")),Seq(AM(LChoice(BA(Seq(CallNoArgs(SVar("table-get")),Not(Match(NoAnnoList(List([]))))),NoAnnoList(Tuple([Var("ns"),NoAnnoList(Op("Scopes",[]))]))),Build(NoAnnoList(List([NoAnnoList(List([]))])))),NoAnnoList(ListTail([Var("scope")],Var("scopes")))),Seq(BA(CallNoArgs(SVar("table-put")),NoAnnoList(Tuple([Var("ns"),NoAnnoList(Op("Scopes",[])),Var("scopes")]))),BA(Call(SVar("map"),[LRule(RuleNoCond(Var("key"),App(CallNoArgs(SVar("table-pop-rm")),NoAnnoList(Tuple([Var("ns"),Var("key")])))))]),Var("scope"))))))),SDef("scope",[DefaultVarDec("ns"),DefaultVarDec("s")],Seq(Call(SVar("begin-scope"),[CallNoArgs(SVar("ns"))]),Call(SVar("restore-always"),[CallNoArgs(SVar("s")),Call(SVar("end-scope"),[CallNoArgs(SVar("ns"))])]))),SDef("assert",[DefaultVarDec("ns")],Seq(Match(NoAnnoList(Tuple([Var("key"),Var("val")]))),Where(Seq(AM(CallNoArgs(SVar("ns")),Var("ns")),Seq(BA(CallNoArgs(SVar("table-push")),NoAnnoList(Tuple([Var("ns"),Var("key"),Var("val")]))),Seq(AM(LChoice(BA(Seq(CallNoArgs(SVar("table-get")),Not(Match(NoAnnoList(List([]))))),NoAnnoList(Tuple([Var("ns"),NoAnnoList(Op("Scopes",[]))]))),Build(NoAnnoList(List([NoAnnoList(List([]))])))),NoAnnoList(ListTail([Var("scope")],Var("scopes")))),BA(CallNoArgs(SVar("table-put")),NoAnnoList(Tuple([Var("ns"),NoAnnoList(Op("Scopes",[])),NoAnnoList(ListTail([NoAnnoList(ListTail([Var("key")],Var("scope")))],Var("scopes")))]))))))))),SDef("override-key",[DefaultVarDec("ns")],Seq(Match(NoAnnoList(Tuple([Var("key"),Var("val")]))),Where(Seq(AM(CallNoArgs(SVar("ns")),Var("ns")),BA(CallNoArgs(SVar("table-replace")),NoAnnoList(Tuple([Var("ns"),Var("key"),Var("val")]))))))),SDef("rewrite",[DefaultVarDec("ns")],LRule(RuleNoCond(Var("key"),App(CallNoArgs(SVar("table-lookup")),NoAnnoList(Tuple([App(CallNoArgs(SVar("ns")),NoAnnoList(Tuple([]))),Var("key")])))))),SDef("extend-assert",[DefaultVarDec("ns")],Seq(Match(NoAnnoList(Tuple([Var("key"),Var("val")]))),Where(Seq(AM(CallNoArgs(SVar("ns")),Var("ns")),Seq(AM(LChoice(BA(Seq(CallNoArgs(SVar("table-get")),Not(Match(NoAnnoList(List([]))))),NoAnnoList(Tuple([Var("ns"),NoAnnoList(Op("Scopes",[]))]))),Build(NoAnnoList(List([NoAnnoList(List([]))])))),NoAnnoList(ListTail([Var("scope")],Var("scopes")))),LChoice(Seq(BA(CallNoArgs(SVar("elem")),NoAnnoList(Tuple([Var("key"),Var("scope")]))),Seq(AM(BA(CallNoArgs(SVar("table-get")),NoAnnoList(Tuple([Var("ns"),Var("key")]))),NoAnnoList(ListTail([Var("prevvals")],Var("morevals")))),BA(CallNoArgs(SVar("table-put")),NoAnnoList(Tuple([Var("ns"),Var("key"),NoAnnoList(ListTail([NoAnnoList(ListTail([Var("val")],Var("prevvals")))],Var("morevals")))]))))),Seq(BA(CallNoArgs(SVar("table-push")),NoAnnoList(Tuple([Var("ns"),Var("key"),NoAnnoList(List([Var("val")]))]))),BA(CallNoArgs(SVar("table-put")),NoAnnoList(Tuple([Var("ns"),NoAnnoList(Op("Scopes",[])),NoAnnoList(ListTail([NoAnnoList(ListTail([Var("key")],Var("scope")))],Var("scopes")))])))))))))),SDef("extend-override-key",[DefaultVarDec("ns")],Seq(Match(NoAnnoList(Tuple([Var("key"),Var("val")]))),Where(Seq(AM(CallNoArgs(SVar("ns")),Var("ns")),Seq(AM(BA(CallNoArgs(SVar("table-get")),NoAnnoList(Tuple([Var("ns"),Var("key")]))),NoAnnoList(ListTail([Var("prevvals")],Var("morevals")))),BA(CallNoArgs(SVar("table-put")),NoAnnoList(Tuple([Var("ns"),Var("key"),NoAnnoList(ListTail([NoAnnoList(ListTail([Var("val")],Var("prevvals")))],Var("morevals")))])))))))),SDef("extend-assert-undefined",[DefaultVarDec("ns")],Seq(Match(Var("key")),Where(Seq(AM(CallNoArgs(SVar("ns")),Var("ns")),Seq(AM(LChoice(BA(Seq(CallNoArgs(SVar("table-get")),Not(Match(NoAnnoList(List([]))))),NoAnnoList(Tuple([Var("ns"),NoAnnoList(Op("Scopes",[]))]))),Build(NoAnnoList(List([NoAnnoList(List([]))])))),NoAnnoList(ListTail([Var("scope")],Var("scopes")))),LChoice(Seq(BA(CallNoArgs(SVar("elem")),NoAnnoList(Tuple([Var("key"),Var("scope")]))),Seq(AM(BA(CallNoArgs(SVar("table-get")),NoAnnoList(Tuple([Var("ns"),Var("key")]))),NoAnnoList(ListTail([Var("prevvals")],Var("morevals")))),BA(CallNoArgs(SVar("table-put")),NoAnnoList(Tuple([Var("ns"),Var("key"),NoAnnoList(ListTail([NoAnnoList(List([]))],Var("morevals")))]))))),Seq(BA(CallNoArgs(SVar("table-push")),NoAnnoList(Tuple([Var("ns"),Var("key"),NoAnnoList(List([]))]))),BA(CallNoArgs(SVar("table-put")),NoAnnoList(Tuple([Var("ns"),NoAnnoList(Op("Scopes",[])),NoAnnoList(ListTail([NoAnnoList(ListTail([Var("key")],Var("scope")))],Var("scopes")))])))))))))),SDef("extend-override-key-undefined",[DefaultVarDec("ns")],Seq(Match(Var("key")),Where(Seq(AM(CallNoArgs(SVar("ns")),Var("ns")),Seq(AM(BA(CallNoArgs(SVar("table-get")),NoAnnoList(Tuple([Var("ns"),Var("key")]))),NoAnnoList(ListTail([Var("prevvals")],Var("morevals")))),BA(CallNoArgs(SVar("table-put")),NoAnnoList(Tuple([Var("ns"),Var("key"),NoAnnoList(ListTail([NoAnnoList(List([]))],Var("morevals")))])))))))),SDef("extend-rewrite",[DefaultVarDec("ns")],Call(SVar("rewrite"),[CallNoArgs(SVar("ns"))]))])])
